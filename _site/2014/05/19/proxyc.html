<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <!--[if lte IE 9]><meta http-equiv="refresh" content="0;url=/ie.html"><![endif]-->

    <title>Proxy模式C++实现</title>
    <meta name="author" content="JasonLe">

    <link rel="stylesheet" type="text/css" href="/assets/css/style.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/prism.css"> 
  </head>
  <body>
    <aside id="sidebar">
      <nav id="tags">
        <a href="/index.html" id="avatar"></a>

        <ul id="tags__ul">
		  <li id="js-label1" class="tags__li tags-btn active">全部文章</li>
		  <li id="js-label2" class="tags__li tags-btn">Linux</li>
          <li id="js-label3" class="tags__li tags-btn">JOS</li>
          <li id="js-label4" class="tags__li tags-btn">DesginPattern</li>
          <li id="js-label5" class="tags__li tags-btn">读书笔记</li>
          <li id="js-label6" class="tags__li tags-btn">杂谈</li>
        </ul>
<!--
        <div id="tags__bottom">
          <a href="mailto:ldm5235@gmail.com" id="icon-email" class="tags-btn fontello"></a>
          <a href="/rss.xml" id="icon-feed" class="tags-btn fontello"></a>
        </div>
  -->      
      </nav> <!-- end #tags -->

      <div id="posts-list">
         
          <form action="#" id="search-form">
          <!-- NOTE: input field is disabled by default -->
          <input id="search-input" type="text" placeholder="" disabled="" >
          </form>

        <nav id="pl__container">
        
          <a class="jos pl__all" href="/2014/06/08/user-excption-stack-design.html" title="User Excption Stack Design"><span class="pl__circle"></span><span class="pl__title">
          
          User Excption Stack De...
          
          </span><span class="pl__date">Jun 2014</span></a>
        
          <a class="designpattern pl__all" href="/2014/06/06/Strategy-Pattern-with-c.html" title="Strategy Pattern with C++"><span class="pl__circle"></span><span class="pl__title">
          
          Strategy Pattern with C++
          
          </span><span class="pl__date">Jun 2014</span></a>
        
          <a class="designpattern pl__all" href="/2014/06/03/decorator-pattern-with-c.html" title="Decorator Pattern with C++"><span class="pl__circle"></span><span class="pl__title">
          
          Decorator Pattern with...
          
          </span><span class="pl__date">Jun 2014</span></a>
        
          <a class="designpattern pl__all" href="/2014/06/03/commander-pattern-and-chain-of-responsibility-pattern-with-c.html" title="Commander Pattern and Chain of Responsibility Pattern with C++"><span class="pl__circle"></span><span class="pl__title">
          
          Commander Pattern and ...
          
          </span><span class="pl__date">Jun 2014</span></a>
        
          <a class="designpattern pl__all" href="/2014/05/22/mediatorc.html" title="Mediator模式C++实现"><span class="pl__circle"></span><span class="pl__title">
          
          Mediator模式C++实现
          
          </span><span class="pl__date">May 2014</span></a>
        
          <a class="designpattern pl__all" href="/2014/05/19/proxyc.html" title="Proxy模式C++实现"><span class="pl__circle"></span><span class="pl__title">
          
          Proxy模式C++实现
          
          </span><span class="pl__date">May 2014</span></a>
        
          <a class="designpattern pl__all" href="/2014/05/19/protype_iteratorc.html" title="Protype_IteratorC++实现"><span class="pl__circle"></span><span class="pl__title">
          
          Protype_IteratorC++实现
          
          </span><span class="pl__date">May 2014</span></a>
        
          <a class="designpattern pl__all" href="/2014/05/13/template_builder_designpattern.html" title="Template_Builder_DesignPattern"><span class="pl__circle"></span><span class="pl__title">
          
          Template_Builder_Desig...
          
          </span><span class="pl__date">May 2014</span></a>
        
          <a class="linux pl__all" href="/2014/05/07/unix_thread_api.html" title="Unix_Thread_API备注"><span class="pl__circle"></span><span class="pl__title">
          
          Unix_Thread_API备注
          
          </span><span class="pl__date">May 2014</span></a>
        
          <a class="designpattern pl__all" href="/2014/05/03/factory_designpattern.html" title="Factory_DesignPattern"><span class="pl__circle"></span><span class="pl__title">
          
          Factory_DesignPattern
          
          </span><span class="pl__date">May 2014</span></a>
        
          <a class="linux pl__all" href="/2014/04/14/ram_management3.html" title="RAM_Management3个层次的关系"><span class="pl__circle"></span><span class="pl__title">
          
          RAM_Management3个层次的关系
          
          </span><span class="pl__date">Apr 2014</span></a>
        
          <a class="read pl__all" href="/2014/04/14/linux-vm.html" title="Linux VM虚拟存储器系统（读书笔记）"><span class="pl__circle"></span><span class="pl__title">
          
          Linux VM虚拟存储器系统（读书笔记）
          
          </span><span class="pl__date">Apr 2014</span></a>
        
          <a class="jos pl__all" href="/2014/04/09/jospriorityrr_sched.html" title="在JOS上实现基于Priority的RR_sched"><span class="pl__circle"></span><span class="pl__title">
          
          在JOS上实现基于Priority的RR_s...
          
          </span><span class="pl__date">Apr 2014</span></a>
        
          <a class="linux pl__all" href="/2014/04/08/systemcall.html" title="Systemcall流程"><span class="pl__circle"></span><span class="pl__title">
          
          Systemcall流程
          
          </span><span class="pl__date">Apr 2014</span></a>
        
          <a class="others pl__all" href="/2014/03/30/markdown-grammer.html" title="Markdown grammer"><span class="pl__circle"></span><span class="pl__title">
          
          Markdown grammer
          
          </span><span class="pl__date">Mar 2014</span></a>
        
          <a class="jos pl__all" href="/2014/03/26/idtmd.html" title="设定IDT表以及中断处理函数编写"><span class="pl__circle"></span><span class="pl__title">
          
          设定IDT表以及中断处理函数编写
          
          </span><span class="pl__date">Mar 2014</span></a>
        
          <a class="read pl__all" href="/2014/03/13/interrupt.html" title="异常控制流（读书笔记）"><span class="pl__circle"></span><span class="pl__title">
          
          异常控制流（读书笔记）
          
          </span><span class="pl__date">Mar 2014</span></a>
        
          <a class="jos pl__all" href="/2014/03/10/jos.html" title="JOS虚拟页表的实现"><span class="pl__circle"></span><span class="pl__title">
          
          JOS虚拟页表的实现
          
          </span><span class="pl__date">Mar 2014</span></a>
        
          <a class="jos pl__all" href="/2014/03/04/jos.html" title="JOS的物理页表分配实现"><span class="pl__circle"></span><span class="pl__title">
          
          JOS的物理页表分配实现
          
          </span><span class="pl__date">Mar 2014</span></a>
        
          <a class="jos pl__all" href="/2014/02/24/frame-info.html" title="打印Frame Info"><span class="pl__circle"></span><span class="pl__title">
          
          打印Frame Info
          
          </span><span class="pl__date">Feb 2014</span></a>
        
          <a class="read pl__all" href="/2014/01/03/linux.html" title="Linux系统调用（读书笔记）"><span class="pl__circle"></span><span class="pl__title">
          
          Linux系统调用（读书笔记）
          
          </span><span class="pl__date">Jan 2014</span></a>
        
          <a class="linux pl__all" href="/2013/12/18/systemtap-kprobe.html" title="SystemTap Kprobe原理"><span class="pl__circle"></span><span class="pl__title">
          
          SystemTap Kprobe原理
          
          </span><span class="pl__date">Dec 2013</span></a>
        
          <a class="read pl__all" href="/2013/12/11/kernel-development.html" title="内核开发特点&进程管理（读书笔记）"><span class="pl__circle"></span><span class="pl__title">
          
          内核开发特点&进程管理（读书笔记）
          
          </span><span class="pl__date">Dec 2013</span></a>
        
          <a class="read pl__all" href="/2013/12/10/storage.html" title="Storage层次结构（读书笔记）"><span class="pl__circle"></span><span class="pl__title">
          
          Storage层次结构（读书笔记）
          
          </span><span class="pl__date">Dec 2013</span></a>
        
          <a class="read pl__all" href="/2013/12/04/cpu.html" title="CPU指令并行化（读书笔记）"><span class="pl__circle"></span><span class="pl__title">
          
          CPU指令并行化（读书笔记）
          
          </span><span class="pl__date">Dec 2013</span></a>
        
          <a class="linux pl__all" href="/2013/11/29/gprof-.html" title="GPROF 使用"><span class="pl__circle"></span><span class="pl__title">
          
          GPROF 使用
          
          </span><span class="pl__date">Nov 2013</span></a>
        
          <a class="read pl__all" href="/2013/11/28/programme_opinion.html" title="programme_opinion（读书笔记）"><span class="pl__circle"></span><span class="pl__title">
          
          programme_opinion（读书笔记）
          
          </span><span class="pl__date">Nov 2013</span></a>
        
          <a class="linux pl__all" href="/2013/11/22/share-object-library.html" title="编写Share Object Library"><span class="pl__circle"></span><span class="pl__title">
          
          编写Share Object Library
          
          </span><span class="pl__date">Nov 2013</span></a>
        
          <a class="linux pl__all" href="/2013/11/22/ltrace-strace-ftrace.html" title="调试工具ltrace strace ftrace的使用"><span class="pl__circle"></span><span class="pl__title">
          
          调试工具ltrace strace ftra...
          
          </span><span class="pl__date">Nov 2013</span></a>
        
          <a class="linux pl__all" href="/2013/11/13/linux-kernel.html" title="裁剪编译Linux Kernel"><span class="pl__circle"></span><span class="pl__title">
          
          裁剪编译Linux Kernel
          
          </span><span class="pl__date">Nov 2013</span></a>
        
        </nav>
      </div> <!-- end #posts-list -->
    </aside> <!-- end #sidebar -->

    <div id="post">
      <div id="pjax">
        <article id="post__content">
  <h1 id="post__title" data-identifier="20140519">Proxy模式C++实现</h1>
  <h1>代理模式 C++实现</h1>

<p>代理模式是一种常用的设计模式，他可以使得真实的角色就是实现业务的逻辑，不用关心非其本职责的实务，而是依靠后期代理实现。
这种方式可以实现解耦，让我们类的职责更加明确。
代理模式有很多种，有普通代理，强制代理，还有动态代理。</p>

<h6>普通代理模式与强制代理模式的区别在于真正实现业务的逻辑由谁创建？强制代理模式表示必须由业务者创建，普通代理则认为可以由代理者创建！</h6>

<h6>这种普通代理模式主要应用在smart_ptr中。</h6>

<p><img src="/assets/pic/55800.png" alt="" /></p>

<pre><code>
#include<iostream>
#include<string>
using namespace std;
 
class IGamePlayer
{
public:
    virtual void login(string user,string password) =0;
    virtual void killBoss()=0;
    virtual void update()=0;
};
 
class GamePlayer:public IGamePlayer
{
private :
    string name;
public:
    GamePlayer(IGamePlayer *_gameplayer,string _name)
    {
        name = _name;
        if(_gameplayer==NULL)
            cout << "_gameplayer failture" << endl;
    }
    void killBoss(){ cout << "killBoss" <<endl;}
    void login(string user,string password){ cout << user << "  "<<password <<endl;}
    void update(){ cout << "update!" <<endl; }
};
 
class GamePlayerProxy:public IGamePlayer
{
private:
    IGamePlayer *gameplayer;
public:
    GamePlayerProxy(string name)
    {
        gameplayer = new GamePlayer(this,name);
        if(gameplayer ==NULL)
            cout << "Create failture!" << endl;
    }
    void killBoss() {gameplayer->killBoss();}
    void login(string user,string password){gameplayer->login(user,password);}
    void update(){gameplayer->update();}
};
 
int main()
{
    IGamePlayer *proxy = new GamePlayerProxy("user1");
    proxy->login("lzz","lzz");
    proxy->killBoss();
    proxy->update();
    delete proxy;
    return 0;
}
</code></pre>


<h3>强制代理与普通代理的不同在于业务函数必须由业务类制剂创建！并由业务类返回代理者！</h3>

<pre><code>
#include<iostream>
#include<string>
using namespace std;
 
 
class IGamePlayer
{
public:
    virtual void login(string user,string password) =0;
    virtual void killBoss()=0;
    virtual void update()=0;
    virtual IGamePlayer* getProxy()=0;
};
 
class GamePlayerProxy:public IGamePlayer
{
private:
    IGamePlayer *gameplayer;
public:
    GamePlayerProxy(IGamePlayer *_gameplayer)
    {
        this->gameplayer = _gameplayer;
    }
    void killBoss() {this->gameplayer->killBoss();}
    void login(string user,string password){this->gameplayer->login(user,password);}
    void update(){this->gameplayer->update();}
    IGamePlayer* getProxy(){ return this;}
};
 
class GamePlayer:public IGamePlayer
{
private :
    string name;
    IGamePlayer *Proxy;
    bool isProxy()
    {
        if(Proxy==NULL)
            return false;
        else
            return true;
    }
public:
    GamePlayer(string _name)
    {
        name = _name;
    }
    IGamePlayer* getProxy()
    {
        this->Proxy = new GamePlayerProxy(this);
        return Proxy;
    }
    void killBoss(){ if(isProxy())cout << "killBoss" <<endl;}
    void login(string user,string password){ if(isProxy()) cout << user << "  "<<password <<endl;}
    void update(){ if(isProxy())cout << "update!" <<endl; }
 
};
 
int main()
{
    IGamePlayer *player = new GamePlayer("user1");
    IGamePlayer *proxy = player->getProxy();
    proxy->login("lzz","lzz");
    proxy->killBoss();
    proxy->update();
    delete proxy;
    return 0;
}
</code></pre>


<p>还有一种动态代理的模式，主要用在Java中，动态代理在实现阶段不在乎代理谁，而主要在运行阶段才真正的代理。</p>

<p>handler只需要继承InvocationHandler即可，然后再invoke（）中返回要调用的方法或者函数。</p>

</article> <!-- end #post__content -->

<div id="post__share">
  <a id="icon-twitter" class="fontello" href="https://twitter.com/intent/tweet?url=http://lzz5235.github.com/2014/05/19/proxyc.html&text=Proxy模式C++实现" target="_blank"></a>
  <a id="icon-cc" class="fontello" href="http://creativecommons.org/licenses/by-nc-sa/3.0" target="_blank"></a>
  <a id="icon-weibo" class="fontello" href="http://v.t.sina.com.cn/share/share.php?url=http://lzz5235.github.com/2014/05/19/proxyc.html&title=Proxy模式C++实现" target="_blank"></a>
</div> <!-- end #post__share -->

<div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink" target="_blank">Loading Disqus comments...</a>
</div> <!-- end #disqus_thread -->

<p id="copyright">Powered by <a href="http://jekyllrb.com" target="_blank">Jekyll</a>&nbsp;&nbsp;|&nbsp;&nbsp;Theme <a href="https://github.com/P233/3-Jekyll" target="_blank">3-Jekyll</a>&nbsp;&nbsp;Fork My <a href="https://github.com/lzz5235" target="_blank">Github</a></p>

      </div> <!-- end #pjax -->

      <div id="post__toc-trigger">
        <div id="post__toc">
          <span id="post__toc-title">目录导航</span>
          <ul id="post__toc-ul"></ul>
        </div>
      </div>
    </div> <!-- end #post -->

    <button id="js-fullscreen"><span id="icon-arrow" class="fontello"></span></button>
    <a id="scrollUp" href="javascript:void(0);" title="" style="position: fixed; z-index: 2147483647; display: none;"></a>
   
    <script src="/assets/js/jquery-2.0.3.min.js"></script>
    <script src="/assets/js/jquery.pjax.js"></script>
    <script src="/assets/js/nprogress.js"></script>
    <script src="/assets/js/script.js"></script>
   <!--
    <script src="/assets/js/prism.js"></script>
    -->
   <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-51310656-1', 'builderqiu.github.io');
    ga('send', 'pageview');

  </script>
  </body>
</html>
