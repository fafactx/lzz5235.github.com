<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <!--[if lte IE 9]><meta http-equiv="refresh" content="0;url=/ie.html"><![endif]-->

    <title>Protype_IteratorC++实现</title>
    <meta name="description" content="">

    <link rel="stylesheet" type="text/css" href="/assets/css/style.css">
  </head>
  <body>
    <aside id="sidebar">
      <nav id="tags">
        <a href="/index.html" id="avatar"></a>

        <ul id="tags__ul">
		  <li id="js-label1" class="tags__li tags-btn active">全部文章</li>
		  <li id="js-label2" class="tags__li tags-btn">Kernel内核</li>
          <li id="js-label3" class="tags__li tags-btn">JOS</li>
          <li id="js-label4" class="tags__li tags-btn">Qt</li>
          <li id="js-label5" class="tags__li tags-btn">Grammer</li>
          <li id="js-label6" class="tags__li tags-btn">读书笔记</li>
        </ul>

        <div id="tags__bottom">
          <a href="mailto:ldm5235@gmail.com" id="icon-email" class="tags-btn fontello"></a>
          <a href="/rss.xml" id="icon-feed" class="tags-btn fontello"></a>
        </div>
      </nav> <!-- end #tags -->

      <div id="posts-list">
        <form action="" id="search-form">
          <a href="/index.html" id="mobile-avatar"></a>
          <!-- NOTE: input field is disabled by default -->
          <input id="search-input" type="text" placeholder="Search...">
        </form>

        <nav id="pl__container">
        
          <a class="jos pl__all" href="/2014/06/08/user-excption-stack-design.html"><span class="pl__circle"></span><span class="pl__title">User Excption Stack Design</span><span class="pl__date">Jun 2014</span></a>
        
          <a class="designpattern pl__all" href="/2014/06/06/Strategy-Pattern-with-c.html"><span class="pl__circle"></span><span class="pl__title">Strategy Pattern with C++</span><span class="pl__date">Jun 2014</span></a>
        
          <a class="designpattern pl__all" href="/2014/06/03/decorator-pattern-with-c.html"><span class="pl__circle"></span><span class="pl__title">Decorator Pattern with C++</span><span class="pl__date">Jun 2014</span></a>
        
          <a class="designpattern pl__all" href="/2014/06/03/commander-pattern-and-chain-of-responsibility-pattern-with-c.html"><span class="pl__circle"></span><span class="pl__title">Commander Pattern and Chain of Responsibility Pattern with C++</span><span class="pl__date">Jun 2014</span></a>
        
          <a class="designpattern pl__all" href="/2014/05/22/mediatorc.html"><span class="pl__circle"></span><span class="pl__title">Mediator模式C++实现</span><span class="pl__date">May 2014</span></a>
        
          <a class="designpattern pl__all" href="/2014/05/19/proxyc.html"><span class="pl__circle"></span><span class="pl__title">Proxy模式C++实现</span><span class="pl__date">May 2014</span></a>
        
          <a class="designpattern pl__all" href="/2014/05/19/protype_iteratorc.html"><span class="pl__circle"></span><span class="pl__title">Protype_IteratorC++实现</span><span class="pl__date">May 2014</span></a>
        
          <a class="designpattern pl__all" href="/2014/05/13/template_builder_designpattern.html"><span class="pl__circle"></span><span class="pl__title">Template_Builder_DesignPattern</span><span class="pl__date">May 2014</span></a>
        
          <a class="linux pl__all" href="/2014/05/07/unix_thread_api.html"><span class="pl__circle"></span><span class="pl__title">Unix_Thread_API备注</span><span class="pl__date">May 2014</span></a>
        
          <a class="designpattern pl__all" href="/2014/05/03/factory_designpattern.html"><span class="pl__circle"></span><span class="pl__title">Factory_DesignPattern</span><span class="pl__date">May 2014</span></a>
        
          <a class="linux pl__all" href="/2014/04/14/ram_management3.html"><span class="pl__circle"></span><span class="pl__title">RAM_Management3个层次的关系</span><span class="pl__date">Apr 2014</span></a>
        
          <a class="linux pl__all" href="/2014/04/14/linux-vm.html"><span class="pl__circle"></span><span class="pl__title">Linux VM虚拟存储器系统（读书笔记）</span><span class="pl__date">Apr 2014</span></a>
        
          <a class="jos pl__all" href="/2014/04/09/jospriorityrr_sched.html"><span class="pl__circle"></span><span class="pl__title">在JOS上实现基于Priority的RR_sched</span><span class="pl__date">Apr 2014</span></a>
        
          <a class="linux pl__all" href="/2014/04/08/systemcall.html"><span class="pl__circle"></span><span class="pl__title">Systemcall流程</span><span class="pl__date">Apr 2014</span></a>
        
          <a class="language pl__all" href="/2014/03/30/markdown-grammer.html"><span class="pl__circle"></span><span class="pl__title">Markdown grammer</span><span class="pl__date">Mar 2014</span></a>
        
          <a class="jos pl__all" href="/2014/03/26/idtmd.html"><span class="pl__circle"></span><span class="pl__title">设定IDT表以及中断处理函数编写</span><span class="pl__date">Mar 2014</span></a>
        
          <a class="linux pl__all" href="/2014/03/13/interrupt.html"><span class="pl__circle"></span><span class="pl__title">异常控制流（读书笔记）</span><span class="pl__date">Mar 2014</span></a>
        
          <a class="jos pl__all" href="/2014/03/10/jos.html"><span class="pl__circle"></span><span class="pl__title">JOS虚拟页表的实现</span><span class="pl__date">Mar 2014</span></a>
        
          <a class="jos pl__all" href="/2014/03/04/jos.html"><span class="pl__circle"></span><span class="pl__title">JOS的物理页表分配实现</span><span class="pl__date">Mar 2014</span></a>
        
          <a class="jos pl__all" href="/2014/02/24/frame-info.html"><span class="pl__circle"></span><span class="pl__title">打印Frame Info</span><span class="pl__date">Feb 2014</span></a>
        
          <a class="linux pl__all" href="/2014/01/03/linux.html"><span class="pl__circle"></span><span class="pl__title">Linux系统调用（读书笔记）</span><span class="pl__date">Jan 2014</span></a>
        
          <a class="linux pl__all" href="/2013/12/18/systemtap-kprobe.html"><span class="pl__circle"></span><span class="pl__title">SystemTap Kprobe原理</span><span class="pl__date">Dec 2013</span></a>
        
          <a class="linux pl__all" href="/2013/12/11/kernel-development.html"><span class="pl__circle"></span><span class="pl__title">内核开发特点&进程管理（读书笔记）</span><span class="pl__date">Dec 2013</span></a>
        
          <a class="arch pl__all" href="/2013/12/10/storage.html"><span class="pl__circle"></span><span class="pl__title">Storage层次结构（读书笔记）</span><span class="pl__date">Dec 2013</span></a>
        
          <a class="arch pl__all" href="/2013/12/04/cpu.html"><span class="pl__circle"></span><span class="pl__title">CPU指令并行化（读书笔记）</span><span class="pl__date">Dec 2013</span></a>
        
          <a class="linux pl__all" href="/2013/11/29/gprof-.html"><span class="pl__circle"></span><span class="pl__title">GPROF 使用</span><span class="pl__date">Nov 2013</span></a>
        
          <a class="linux pl__all" href="/2013/11/28/programme_opinion.html"><span class="pl__circle"></span><span class="pl__title">programme_opinion（读书笔记）</span><span class="pl__date">Nov 2013</span></a>
        
          <a class="linux pl__all" href="/2013/11/22/share-object-library.html"><span class="pl__circle"></span><span class="pl__title">编写Share Object Library</span><span class="pl__date">Nov 2013</span></a>
        
          <a class="linux pl__all" href="/2013/11/22/ltrace-strace-ftrace.html"><span class="pl__circle"></span><span class="pl__title">调试工具ltrace strace ftrace的使用</span><span class="pl__date">Nov 2013</span></a>
        
          <a class="linux pl__all" href="/2013/11/13/linux-kernel.html"><span class="pl__circle"></span><span class="pl__title">裁剪编译Linux Kernel</span><span class="pl__date">Nov 2013</span></a>
        
        </nav>
      </div> <!-- end #posts-list -->
    </aside> <!-- end #sidebar -->

    <div id="post">
      <div id="pjax">
        <article id="post__content">
  <h1 id="post__title" data-identifier="20140519">Protype_IteratorC++实现</h1>
  <h1>原型模式 迭代器模式 C++实现</h1>

<p>原型模式其实非常简单，难易程度其实就是单例模式与迭代器模式差不多。
在Java中我们可以有很多的接口使用，在这里，我们也许会用到Cloneable接口，然后在复制的类里面实现clone方法。</p>

<h5>调用这个clone（）就等于完成了类的复制，而不是通过new来创建。Clone（）方法是在内存中进行拷贝，所以不会调用构造函数！</h5>

<p>final与clone不共融，final使用后，就意味着无法进行重写，而调用clone（）必须重写！</p>

<p>我们知道在OO语言中，有深拷贝与浅拷贝之分。浅拷贝只拷贝类对象，类里面的数组都共享一份，这期中就有潜在的风险。而深拷贝则是完全将对象拷贝两份，也就是说内存中含有两份一模一样的对象！</p>

<h5>扯完Java，我来用C++实现原型模式，C++中没有什么clone接口，所以我们完全要手动来做。</h5>

<blockquote><p>这里有个小插曲：
因为我是在vs2012中编译的。目前vs2012已经把strcpy函数禁用掉，因为存在不安全性。</p></blockquote>

<p><img src="/assets/pic/70658.png" alt="" /></p>

<p>正如之前爆出的heartbleed漏洞，也是未对字符串赋值进行检查导致，所以我们这里使用strcpy_s()不过这样确实丧失了移植性。需要注意一下。
如果我们不需要这种提醒，可以在设置中把预编译检查关闭！</p>

<p><img src="/assets/pic/71649.png" alt="" /></p>

<pre><code>
#include<iostream>
#include<string>
using namespace std;
 
 
class Mail
{
public:
    Mail(){};
    virtual Mail* Clone(){return NULL;}
    virtual void show() =0;
    char *getstr(){return name;}
protected:
    char* name;
};
 
class MailA :public Mail
{
public:
    MailA(char *str)
    {
        if(str==NULL){      name = new char[10];    name[9]='\0';}
        else{name = new char[strlen(str)+1]; strcpy_s(name,10,str);}
    }
    ~MailA(){delete name;}
    MailA(Mail &r){     name = new char[strlen(r.getstr())+1]; strcpy_s(name,strlen(r.getstr())+1,r.getstr());  }
    Mail* Clone(){return (Mail *)new MailA(*this);}
    void show(){cout << name << endl;}
};
 
class MailB :public Mail
{
public:
    MailB(char *str)
    {
        if(str==NULL){      name = new char[10];    name[9]='\0';}
        else{name = new char[strlen(str)+1]; strcpy_s(name,10,str);}
    }
    ~MailB(){delete name;}
    MailB(Mail &r){     name = new char[strlen(r.getstr())+1]; strcpy_s(name,strlen(r.getstr())+1,r.getstr());  }
    Mail* Clone(){return (Mail *)new MailB(*this);}
    void show(){cout << name << endl;}
};
 
int main()
{
    Mail *m1 = new MailA("A");
    Mail *m2 = new MailB("B");
    Mail *m3 = m1->Clone();
    Mail *m4 = m2->Clone();
    m1->show(); m2->show(); //删除m1,m2  
    delete m1; delete m2;     
    m1 = m2 = NULL;  
 
    //深拷贝所以对m3,m4无影响  
    m3->show(); m4->show();  
    delete m3; delete m4;  
    m3 = m4 = NULL;  
}
</code></pre>


<h5>迭代器模式如STL，通过容器来管理复杂的数据结构，类等。然后通过iteration来迭代，俗称迭代器模式。</h5>

<p>在Java中有现成的迭代器来使用，在C++中，我们需要自己实现这种接口iterator。</p>

<p><img src="/assets/pic/3617.png" alt="" /></p>

<pre><code>
#include<iostream>
#include<string>
#include <vector>
using namespace std;
 
template <class T>
class Iterator
{
public:
    virtual void first()=0;
    virtual void next()=0;
    virtual T* currentItem()=0;
    virtual bool isEnd()=0;
    virtual ~Iterator(){}
};
 
template <class T>
class RealSet;
 
template <class T>
class RealIterator:public Iterator <T>
{
private:
    RealSet<T> *rset;
    int cur_ptr;
public:
    RealIterator(RealSet<T> *a):rset(a),cur_ptr(0){}
    void first(){cur_ptr=0;}
    void next(){if(cur_ptr < rset->getlen() ) cur_ptr++;}
    T* currentItem()
    {
        if(cur_ptr <rset->getlen())   return &(*rset)[cur_ptr];
        else return NULL;
    }
    bool isEnd()
    {
        if(cur_ptr >=rset->getlen())return false;
        return true;
    }
};
 
template <class T>
class Set
{
public:
    virtual Iterator<T>* createIterator()=0;
    virtual void push(T a)=0;
    virtual ~Set(){}
};
 
template <class T>
class RealSet:public Set<T>
{
private:
    vector<T> data;
public:
    RealSet(){}
    ~RealSet(){}
    virtual Iterator<T>* createIterator(){ return new RealIterator<T>(this);}
    virtual T& operator[](int index){return data[index];}
    int getlen(){return data.size();}
    void push(T a)
    {
        data.push_back(a);
    }
};
 
int main()
{
    Set<double> *set = new RealSet<double>();
    Iterator<double> *iter = set->createIterator();
    set->push(3.22);
    set->push(1.86);
    set->push(0.88);
 
    for(iter->first();iter->isEnd();iter->next())
    {
        cout << *iter->currentItem() << endl;
    }
    delete iter;
    delete set;
    return 0;
}
</code></pre>


<h6>确实这种template编程很难，我调试了一下好久才找到问题所在。。。。。。</h6>

</article> <!-- end #post__content -->

<div id="post__share">
  <a id="icon-twitter" class="fontello" href="https://twitter.com/intent/tweet?url=http://lzz5235.github.com/2014/05/19/protype_iteratorc.html&text=Protype_IteratorC++实现" target="_blank"></a>
  <a id="icon-cc" class="fontello" href="http://creativecommons.org/licenses/by-nc-sa/3.0" target="_blank"></a>
  <a id="icon-weibo" class="fontello" href="http://v.t.sina.com.cn/share/share.php?url=http://lzz5235.github.com/2014/05/19/protype_iteratorc.html&title=Protype_IteratorC++实现" target="_blank"></a>
</div> <!-- end #post__share -->

<div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink" target="_blank">Loading Disqus comments...</a>
</div> <!-- end #disqus_thread -->

<p id="copyright">Powered by <a href="http://jekyllrb.com" target="_blank">Jekyll</a>&nbsp;&nbsp;|&nbsp;&nbsp;Theme <a href="https://github.com/P233/3-Jekyll" target="_blank">3-Jekyll</a>&nbsp;&nbsp;Fork My <a href="https://github.com/lzz5235" target="_blank">Github</a></p>

      </div> <!-- end #pjax -->

      <div id="post__toc-trigger">
        <div id="post__toc">
          <span id="post__toc-title">Table of Contents</span>
          <ul id="post__toc-ul"></ul>
        </div>
      </div>
    </div> <!-- end #post -->

    <button id="js-fullscreen"><span id="icon-arrow" class="fontello"></span></button>

    <script src="/assets/js/jquery-2.0.3.min.js"></script>
    <script src="/assets/js/jquery.pjax.js"></script>
    <script src="/assets/js/nprogress.js"></script>
    <script src="/assets/js/script.js"></script>
  </body>
</html>
